{"title":"HBuilder 上传图片到七牛云","slug":"HBuilder-上传图片到七牛云","date":"2017-04-06T15:34:39.000Z","updated":"2019-09-07T10:01:17.096Z","comments":true,"path":"api/articles/HBuilder-上传图片到七牛云.json","excerpt":null,"covers":null,"content":"<p>HBuilder 上传支持表单上传，所以上传到七牛云的时候用的也是表单上传</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 上传图片到七牛云</span></span><br><span class=\"line\"><span class=\"comment\"> * @param String imgPath 图片路径</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">uploadToQiniu</span>(<span class=\"params\">imgPath</span>)</span>&#123;</span><br><span class=\"line\">\t<span class=\"comment\">// 七牛云空间域名，修改为自己的</span></span><br><span class=\"line\">\t<span class=\"keyword\">var</span> domain = <span class=\"string\">\"http://onpzdyxr0.bkt.clouddn.com/\"</span>;</span><br><span class=\"line\">\t<span class=\"comment\">// 生成一个随机名字作为上传到七牛云后的文件名</span></span><br><span class=\"line\">\t<span class=\"keyword\">var</span> randName = <span class=\"built_in\">Math</span>.random().toString(<span class=\"number\">36</span>).substr(<span class=\"number\">2</span>) + imgPath.match(<span class=\"regexp\">/\\.?[^.\\/]+$/</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> task = plus.uploader.createUpload(</span><br><span class=\"line\">       <span class=\"comment\">// 不同的存储空间上传地址可能不一样，运行后根据返回信息做更改</span></span><br><span class=\"line\">\t\t<span class=\"string\">\"http://upload.qiniu.com/\"</span>,</span><br><span class=\"line\">\t\t&#123; </span><br><span class=\"line\">\t\t\tmethod: <span class=\"string\">\"POST\"</span>,</span><br><span class=\"line\">\t\t\tblocksize:<span class=\"number\">204800</span>,</span><br><span class=\"line\">\t\t\tpriority:<span class=\"number\">100</span></span><br><span class=\"line\">\t\t&#125;,</span><br><span class=\"line\">\t\t<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"> t, status </span>) </span>&#123;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// 上传完成</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> ( status == <span class=\"number\">200</span> ) &#123; </span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">console</span>.log( <span class=\"string\">\"Upload success: \"</span> + t.url );</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">// 拼接出上传到去七牛云后的图片链接地址</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">var</span> imgUrl = domain + randName; </span><br><span class=\"line\">\t\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">console</span>.log( <span class=\"string\">\"Upload failed: \"</span> + status );</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t);</span><br><span class=\"line\">\t<span class=\"comment\">// 添加上传文件，key 值必须是七牛云所需文件对应的 key 值 \"file\"</span></span><br><span class=\"line\">\ttask.addFile(imgPath,&#123;<span class=\"attr\">key</span>: <span class=\"string\">\"file\"</span>,<span class=\"attr\">mime</span>: <span class=\"string\">\"image/*\"</span>&#125;);</span><br><span class=\"line\">\t<span class=\"comment\">// 上传到七牛云后文件的名字</span></span><br><span class=\"line\">\ttask.addData(<span class=\"string\">\"key\"</span>,randName);</span><br><span class=\"line\">\t<span class=\"comment\">// 七牛云所需 token</span></span><br><span class=\"line\">\ttask.addData(<span class=\"string\">\"token\"</span>,token);</span><br><span class=\"line\">\t</span><br><span class=\"line\">\ttask.start();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>参考资料：<br><a href=\"http://developer.qiniu.com/kodo/manual/1272/form-upload\" target=\"_blank\" rel=\"noopener\">七牛云表单上传官方文档 &gt;&gt;</a><br><a href=\"http://www.html5plus.org/doc/zh_cn/uploader.html\" target=\"_blank\" rel=\"noopener\">HBuilder 上传官方文档 &gt;&gt;</a></p>\n","more":"<p>HBuilder 上传支持表单上传，所以上传到七牛云的时候用的也是表单上传</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 上传图片到七牛云</span></span><br><span class=\"line\"><span class=\"comment\"> * @param String imgPath 图片路径</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">uploadToQiniu</span>(<span class=\"params\">imgPath</span>)</span>&#123;</span><br><span class=\"line\">\t<span class=\"comment\">// 七牛云空间域名，修改为自己的</span></span><br><span class=\"line\">\t<span class=\"keyword\">var</span> domain = <span class=\"string\">\"http://onpzdyxr0.bkt.clouddn.com/\"</span>;</span><br><span class=\"line\">\t<span class=\"comment\">// 生成一个随机名字作为上传到七牛云后的文件名</span></span><br><span class=\"line\">\t<span class=\"keyword\">var</span> randName = <span class=\"built_in\">Math</span>.random().toString(<span class=\"number\">36</span>).substr(<span class=\"number\">2</span>) + imgPath.match(<span class=\"regexp\">/\\.?[^.\\/]+$/</span>);</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> task = plus.uploader.createUpload(</span><br><span class=\"line\">       <span class=\"comment\">// 不同的存储空间上传地址可能不一样，运行后根据返回信息做更改</span></span><br><span class=\"line\">\t\t<span class=\"string\">\"http://upload.qiniu.com/\"</span>,</span><br><span class=\"line\">\t\t&#123; </span><br><span class=\"line\">\t\t\tmethod: <span class=\"string\">\"POST\"</span>,</span><br><span class=\"line\">\t\t\tblocksize:<span class=\"number\">204800</span>,</span><br><span class=\"line\">\t\t\tpriority:<span class=\"number\">100</span></span><br><span class=\"line\">\t\t&#125;,</span><br><span class=\"line\">\t\t<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"> t, status </span>) </span>&#123;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">// 上传完成</span></span><br><span class=\"line\">\t\t\t<span class=\"keyword\">if</span> ( status == <span class=\"number\">200</span> ) &#123; </span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">console</span>.log( <span class=\"string\">\"Upload success: \"</span> + t.url );</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">// 拼接出上传到去七牛云后的图片链接地址</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">var</span> imgUrl = domain + randName; </span><br><span class=\"line\">\t\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">console</span>.log( <span class=\"string\">\"Upload failed: \"</span> + status );</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t);</span><br><span class=\"line\">\t<span class=\"comment\">// 添加上传文件，key 值必须是七牛云所需文件对应的 key 值 \"file\"</span></span><br><span class=\"line\">\ttask.addFile(imgPath,&#123;<span class=\"attr\">key</span>: <span class=\"string\">\"file\"</span>,<span class=\"attr\">mime</span>: <span class=\"string\">\"image/*\"</span>&#125;);</span><br><span class=\"line\">\t<span class=\"comment\">// 上传到七牛云后文件的名字</span></span><br><span class=\"line\">\ttask.addData(<span class=\"string\">\"key\"</span>,randName);</span><br><span class=\"line\">\t<span class=\"comment\">// 七牛云所需 token</span></span><br><span class=\"line\">\ttask.addData(<span class=\"string\">\"token\"</span>,token);</span><br><span class=\"line\">\t</span><br><span class=\"line\">\ttask.start();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>参考资料：<br><a href=\"http://developer.qiniu.com/kodo/manual/1272/form-upload\" target=\"_blank\" rel=\"noopener\">七牛云表单上传官方文档 &gt;&gt;</a><br><a href=\"http://www.html5plus.org/doc/zh_cn/uploader.html\" target=\"_blank\" rel=\"noopener\">HBuilder 上传官方文档 &gt;&gt;</a></p>\n","categories":[],"tags":[{"name":"HBuilder","path":"api/tags/HBuilder.json"},{"name":"MUI","path":"api/tags/MUI.json"}]}